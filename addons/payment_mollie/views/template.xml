<?xml version="1.0" encoding="utf-8"?>
<odoo>

<template id="mollie_payment_checkout" name="Mollie Payment Checkout" inherit_id="payment.checkout">
    <xpath expr="//div[hasclass('o_payment_option_card')][1]" position="attributes">
        <attribute name="t-if">acquirer.provider != 'mollie'</attribute>
    </xpath>
    <xpath expr="//t/div[hasclass('o_payment_option_card')][1]" position="after">
        <t t-if="acquirer.provider == 'mollie'">
            <t t-call="payment_mollie.mollie_payment_methods_select"/>
        </t>
    </xpath>
</template>

<!-- Mollie supports multiple payment methods (acquirer)
    This templates render all enabled payment options-->
<template id="mollie_payment_methods_select">
    <t t-set="mollie_payment_methods" t-value="acquirer._mollie_get_supported_methods(sale_order or website_sale_order, invoice, amount, currency)"/>
    <t t-foreach="mollie_payment_methods" t-as="payment_method">
        <div name="o_payment_option_card" t-attf-class="card-body o_payment_option_card #{'d-none' if payment_method.method_code == 'applepay' else ''}">
            <label>
                <!-- === Radio button === -->
                <!-- Here we have added mollie as payment-option-type as it will have multiple payment option from same acquirer -->
                <input name="o_payment_radio" type="radio" t-att-checked="acquirer.id == default_payment_option_id and payment_method_index == 0" t-att-class="'' if acquirer_count - 1 + len(mollie_payment_methods) + token_count > 1 else 'd-none'" t-att-data-payment-option-id="payment_method.id" t-att-data-provider="acquirer.provider" t-attf-data-payment-option-type="mollie_method" t-att-data-mollie-method="payment_method.method_code" t-att-data-mollie-issuers="len(payment_method.payment_issuer_ids)" t-att-data-mollie-acquirer-id="acquirer.id"/>
                <!-- === Acquirer name === -->
                <span class="payment_option_name">
                    <b t-esc="payment_method.name"/>
                </span>
                <!-- === "Test Mode" badge === -->
                <span t-if="acquirer.state == 'test'" class="badge-pill badge-warning ml-1">
                    Test Mode
                </span>
            </label>
            <!-- === Payment icon list === -->
            <t t-call="payment.icon_list">
                <t t-set="acquirer" t-value="payment_method"/>
            </t>
            <!-- === Help message === -->
            <div t-if="acquirer.pre_msg" t-out="acquirer.pre_msg" class="text-muted ml-3"/>
        </div>
        <!-- === Acquirer inline form === -->
        <div t-attf-id="o_payment_mollie_method_inline_form_{{payment_method.id}}" name="o_payment_inline_form" class="card-footer d-none">
            <!-- === Inline creadit card  === -->
            <div class="clearfix" t-if="payment_method.method_code == 'creditcard'">
                <t t-call="payment_mollie.mollie_creditcard_component"></t>
            </div>
            <div class="clearfix" t-if="payment_method.payment_issuer_ids">
                <t t-call="payment_mollie.mollie_issuers_list"/>
            </div>
        </div>
    </t>
</template>

<template id="mollie_creditcard_component">
    <div>
        <div id="o_mollie_component" t-att-data-profile_id="acquirer.sudo().mollie_profile_id" t-att-data-mode="acquirer.sudo().state">
            <div class="form-row o_mollie_form mb-1">
                <div class="col-md-12">
                    <label class="label text-muted mb-1" for="mollie-card-holder">Card Holder</label>
                    <div id="mollie-card-holder" class="mollie_input p-2"></div>
                    <div id="mollie-card-holder-error" class="text-danger small"></div>
                </div>
                <div class="col-md-12">
                    <label class="label text-muted mb-1 mt-3" for="mollie-card-number">Card Number</label>
                    <div id="mollie-card-number" class="mollie_input p-2"></div>
                    <div id="mollie-card-number-error" class="text-danger small"></div>
                </div>
                <div class="col-md-6">
                    <label class="label text-muted mb-1 mt-3" for="mollie-expiry-date">Expiry Date</label>
                    <div id="mollie-expiry-date" class="mollie_input p-2"></div>
                    <div id="mollie-expiry-date-error" class="text-danger small"></div>
                </div>
                <div class="col-md-6">
                    <label class="label text-muted mb-1 mt-3" for="mollie-verification-code">Verification code</label>
                    <div id="mollie-verification-code" class="mollie_input p-2"></div>
                    <div id="mollie-verification-code-error" class="text-danger small"></div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="mollie_issuers_list">
    <div class="row o_mollie_issuer_container">
        <t t-foreach="payment_method.payment_issuer_ids" t-as="issuer">
            <div class="col-md-6 col-xs-12">
                <label t-attf-class="bg-white w-100 p-2 border position-relative o_mollie_issuer #{issuer_index == 0 and 'active' or '' }" t-att-data-mollie-issuer="issuer.issuers_code">
                    <span class="payment_option_name">
                        <i class="fa fa-check-circle"></i>
                        <t t-esc="issuer.name"/>
                    </span>
                    <ul class="float-right list-inline payment_icon_list">
                        <t t-foreach="issuer.payment_icon_ids" t-as="pm_icon">
                            <li t-attf-class="list-inline-item">
                                <span t-field="pm_icon.image_payment_form" t-options='{"widget": "image", "alt-field": "name"}'/>
                            </li>
                        </t>
                    </ul>
                </label>
            </div>
        </t>
    </div>
</template>

</odoo>